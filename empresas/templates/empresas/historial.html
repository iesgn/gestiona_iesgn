{% extends "t1bloque.html" %}
{% block content %}

<div class="row">
  <div class="col-md-10 col-md-offset-1">
    <h3>Historial de contactos de {{ empresa.nombre }}</h3>

    <!-- Formulario para añadir nuevo registro -->
    <form method="post" class="form-horizontal" style="margin-bottom:30px;">
      {% csrf_token %}

      <div class="form-group">
        <label class="col-sm-2 control-label">Fecha y hora</label>
        <div class="col-sm-4">
          <input type="datetime-local" name="fecha" value="{{ ahora }}" class="form-control" required>
        </div>
      </div>

      <div class="form-group">
        <label class="col-sm-2 control-label">Descripción</label>
        <div class="col-sm-10">
          <textarea name="texto" rows="6" class="form-control"
                    placeholder="Describe el contacto, llamada, correo o reunión..."></textarea>
        </div>
      </div>

      <div class="form-group text-center" style="margin-top:20px;">
        <button type="submit" class="btn btn-success btn-lg">
          <span class="glyphicon glyphicon-plus"></span> Añadir al historial
        </button>
        <a href="{% url 'empresas:lista' %}" class="btn btn-default btn-lg" style="margin-left:10px;">
          <span class="glyphicon glyphicon-arrow-left"></span> Volver
        </a>
      </div>
    </form>

    <!-- Listado de registros -->
    {% if historial %}
      {% for h in historial %}
      <div class="panel panel-default" style="margin-bottom:20px; border-radius:6px;">
        <div class="panel-heading" style="background-color:#f7f7f7; border-bottom:1px solid #ddd;">
          <strong>{{ h.fecha|date:"d/m/Y H:i" }}</strong>
          &nbsp;&nbsp;|&nbsp;&nbsp;
          <span class="text-muted">{{ h.profesor_nombre|default:h.profesor_username }}</span>
          <form method="post" style="display:inline; float:right; margin-top:-2px;">
            {% csrf_token %}
            <button type="submit" name="borrar" value="{{ h.id }}"
                    class="btn btn-danger btn-xs"
                    title="Eliminar"
                    onclick="return confirm('¿Seguro que deseas eliminar este registro del historial?');">
              <span class="glyphicon glyphicon-trash"></span>
            </button>
          </form>
          <div style="clear:both;"></div>
        </div>
        <div class="panel-body"
             style="word-wrap:break-word; font-size:16px; line-height:1.5em;">
          {{ h.texto }}
        </div>
      </div>
      {% endfor %}
    {% else %}
      <div class="alert alert-info text-center">
        <em>No hay contactos registrados para esta empresa.</em>
      </div>
    {% endif %}
  </div>
</div>

{% endblock %}
